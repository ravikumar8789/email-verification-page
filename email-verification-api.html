<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Verification - Skill Swap Platform</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f6f8fa; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .container { background: #fff; border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 32px; max-width: 400px; width: 100%; text-align: center; }
        .success { color: #2e7d32; }
        .expired { color: #f57c00; }
        .already { color: #1976d2; }
        .loading { color: #757575; }
        button { background: #667eea; color: #fff; border: none; border-radius: 8px; padding: 12px 24px; font-size: 16px; cursor: pointer; margin-top: 16px; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading" class="loading">Processing your verification...</div>
        <div id="success" class="success" style="display:none">
            <h1>✅ Email Verified!</h1>
            <p>You can now return to the app and log in.</p>
        </div>
        <div id="already" class="already" style="display:none">
            <h1>ℹ️ Email Already Verified</h1>
            <p>Your email is already verified. You can log in to your account.</p>
        </div>
        <div id="expired" class="expired" style="display:none">
            <h1>⚠️ Link Expired</h1>
            <p>This verification link has expired or is invalid.</p>
            <button id="resend-btn">Resend Verification Email</button>
        </div>
    </div>
    <script>
        const supabase = window.createClient(
            'https://eaipfjejmhadimwtukjd.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhaXBmamVqbWhhZGltd3R1a2pkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4Mzg4MDksImV4cCI6MjA2NTQxNDgwOX0.EAIj8mXTO-k0rci6idKC0BwhC6ZXWFe9UhK7jzhjV5w'
        );
        const params = new URLSearchParams(window.location.search);
        const error = params.get('error');
        const email = params.get('email');
        let resendCooldown = false;

        async function checkVerification() {
            // If error=expired or error=already_confirmed, try to get user state
            if (error === 'expired' || error === 'already_confirmed' || error === 'access_denied') {
                try {
                    const { data: { user } } = await supabase.auth.getUser();
                    if (user && user.email_confirmed_at) {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('already').style.display = 'block';
                        return;
                    }
                } catch {}
                document.getElementById('loading').style.display = 'none';
                document.getElementById('expired').style.display = 'block';
                return;
            }
            // Normal flow: check if user is verified
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (user && user.email_confirmed_at) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('success').style.display = 'block';
                } else {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('expired').style.display = 'block';
                }
            } catch {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('expired').style.display = 'block';
            }
        }

        document.getElementById('resend-btn').addEventListener('click', async () => {
            if (resendCooldown) return;
            resendCooldown = true;
            const btn = document.getElementById('resend-btn');
            btn.disabled = true;
            btn.textContent = 'Sending...';
            try {
                // Try to get email from URL or prompt user
                let resendEmail = email;
                if (!resendEmail) {
                    resendEmail = prompt('Enter your email to resend verification:');
                }
                if (!resendEmail) throw new Error('Email required');
                await supabase.auth.resend({
                    type: 'signup',
                    email: resendEmail,
                    emailRedirectTo: window.location.origin + window.location.pathname
                });
                btn.textContent = 'Email Sent!';
                setTimeout(() => {
                    btn.textContent = 'Resend Verification Email';
                    btn.disabled = false;
                    resendCooldown = false;
                }, 30000);
            } catch (err) {
                alert('Failed to resend: ' + (err.message || err));
                btn.textContent = 'Resend Verification Email';
                btn.disabled = false;
                resendCooldown = false;
            }
        });

        checkVerification();
    </script>
</body>
</html> 
